<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Date Planner - Nos Rendez-vous 💕</title>
    <link rel="icon" href="images/ben_gene2.png" type="image/png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&family=Kalam:wght@300;400;700&family=Dancing+Script:wght@400;500;600;700&family=Poppins:wght@300;400;500;600;700&family=Orbitron:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/themes-settings.css">
    <link rel="stylesheet" href="css/modals-unified.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--main-font);
            background: var(--theme-gradient);
            background-attachment: fixed;
            min-height: 100vh;
            color: var(--text-primary);
            overflow-x: hidden;
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .back-button {
            position: fixed;
            top: calc(40px + env(safe-area-inset-top, 0px));
            right: 20px;
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            color: white;
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: all 0.3s ease;
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            opacity: 1;
            visibility: visible;
        }

        .back-button:hover {
            background: rgba(255, 255, 255, 0.25);
            border-color: rgba(255, 255, 255, 0.4);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .back-button i {
            font-size: 1.2rem;
        }

        .header {
            text-align: center;
            margin: 120px 0 50px;
            position: relative;
            padding: 30px 20px;
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 25px;
            box-shadow: 
                0 12px 40px rgba(0, 0, 0, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                45deg,
                transparent,
                rgba(255, 255, 255, 0.05),
                transparent,
                rgba(255, 255, 255, 0.05),
                transparent
            );
            animation: shimmer 8s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes shimmer {
            0%, 100% {
                transform: rotate(0deg);
                opacity: 0.3;
            }
            50% {
                transform: rotate(180deg);
                opacity: 0.7;
            }
        }

        .header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            height: 2px;
            background: linear-gradient(90deg, 
                transparent, 
                var(--text-primary), 
                rgba(255, 255, 255, 0.8),
                var(--text-primary), 
                transparent
            );
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        .header h1 {
            font-size: 3.2rem;
            font-weight: 800;
            margin-bottom: 15px;
            color: #ffffff;
            position: relative;
            z-index: 2;
            letter-spacing: 1px;
            animation: titleGlow 3s ease-in-out infinite alternate;
            filter: drop-shadow(0 2px 8px rgba(0, 0, 0, 0.3));
        }

        @keyframes titleGlow {
            0% {
                filter: drop-shadow(0 2px 8px rgba(0, 0, 0, 0.3)) drop-shadow(0 0 20px rgba(255, 255, 255, 0.3));
                transform: scale(1);
            }
            100% {
                filter: drop-shadow(0 2px 8px rgba(0, 0, 0, 0.3)) drop-shadow(0 0 40px rgba(255, 255, 255, 0.8)) drop-shadow(0 0 60px rgba(255, 105, 180, 0.4));
                transform: scale(1.02);
            }
        }

        .header p {
            color: rgba(255, 255, 255, 0.85);
            font-size: 1.2rem;
            font-weight: 500;
            position: relative;
            z-index: 2;
            letter-spacing: 0.5px;
            filter: drop-shadow(0 1px 3px rgba(0, 0, 0, 0.2));
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .header {
                margin: 80px 0 40px;
                padding: 25px 15px;
                border-radius: 20px;
            }
            
            .header h1 {
                font-size: 2.8rem;
                letter-spacing: 0.5px;
            }
            
            .header p {
                font-size: 1.1rem;
            }
            
            .section-card {
                padding: 20px;
            }
            
            .back-button {
                top: calc(15px + env(safe-area-inset-top, 0px));
                right: 15px;
                width: 45px;
                height: 45px;
                font-size: 1.1rem;
            }

            .theme-button {
                top: calc(15px + env(safe-area-inset-top, 0px));
                left: 15px;
                width: 45px;
                height: 45px;
                font-size: 1.1rem;
            }

            .settings-button {
                top: calc(15px + env(safe-area-inset-top, 0px));
                left: 70px;
                width: 45px;
                height: 45px;
                font-size: 1.1rem;
            }

            /* Media queries améliorées pour les boutons */
            .btn {
                padding: 14px 28px;
                font-size: 0.95rem;
                min-height: 48px;
            }
            
            .btn-small {
                padding: 9px 14px;
                font-size: 0.85rem;
                min-height: 38px;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }
            
            .header {
                margin: 60px 0 30px;
                padding: 20px 12px;
                border-radius: 18px;
            }
            
            .header h1 {
                font-size: 2.2rem;
                letter-spacing: 0px;
            }
            
            .header p {
                font-size: 1rem;
            }
            
            .section-card {
                padding: 16px;
            }
            
            .date-card {
                padding: 16px;
            }
            
            .btn {
                padding: 12px 24px;
                font-size: 0.9rem;
                min-height: 44px;
                width: 100%;
                justify-content: center;
            }
            
            .btn-small {
                padding: 8px 12px;
                font-size: 0.8rem;
                min-height: 36px;
                width: 100%;
                justify-content: center;
            }
            
            .date-actions {
                flex-direction: column;
                gap: 10px;
            }
        }

        /* Animation de pulsation pour les boutons importants */
        .btn[type="submit"] {
            animation: subtlePulse 3s ease-in-out infinite;
        }

        @keyframes subtlePulse {
            0%, 100% {
                box-shadow: 
                    0 8px 25px rgba(102, 126, 234, 0.3),
                    0 4px 15px rgba(0, 0, 0, 0.15),
                    inset 0 1px 0 rgba(255, 255, 255, 0.2);
            }
            50% {
                box-shadow: 
                    0 8px 25px rgba(102, 126, 234, 0.4),
                    0 4px 15px rgba(0, 0, 0, 0.15),
                    inset 0 1px 0 rgba(255, 255, 255, 0.2);
            }
        }

        /* Désactiver l'animation au hover */
        .btn[type="submit"]:hover {
            animation: none;
        }

        .section-card {
            background: rgba(255, 255, 255, 0.12);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.25);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
        }

        .section-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title-with-refresh {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .refresh-button {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            position: relative;
            overflow: hidden;
        }

        .refresh-button:hover {
            background: rgba(255, 255, 255, 0.25);
            border-color: rgba(255, 255, 255, 0.5);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .refresh-button:active {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }

        .refresh-button.spinning {
            pointer-events: none;
        }

        .refresh-button.spinning i {
            animation: spin 1s linear;
        }

        .refresh-button:disabled {
            opacity: 0.4;
            background: rgba(255, 255, 255, 0.05);
            cursor: not-allowed;
            pointer-events: none;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-primary);
            font-weight: 500;
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 14px 18px;
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            color: var(--text-primary);
            font-family: inherit;
            font-size: 1rem;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
        }

        /* Styles spécifiques pour les dropdowns */
        .form-select {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: var(--text-primary);
            cursor: pointer;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='%23ffffff' viewBox='0 0 16 16'%3e%3cpath d='M8 13.1l4.5-4.5-.7-.8L8 11.6 4.2 7.8l-.7.8L8 13.1z'/%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 12px;
            padding-right: 40px;
            transition: all 0.3s ease;
        }

        .form-select:hover {
            background: rgba(255, 255, 255, 0.25);
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='%23ffffff' viewBox='0 0 16 16'%3e%3cpath d='M8 13.1l4.5-4.5-.7-.8L8 11.6 4.2 7.8l-.7.8L8 13.1z'/%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 12px;
            border-color: rgba(255, 255, 255, 0.4);
        }

        .form-select:focus {
            background: rgba(255, 255, 255, 0.2);
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='%23ffffff' viewBox='0 0 16 16'%3e%3cpath d='M8 2.9l4.5 4.5-.7.8L8 4.4 4.2 8.2l-.7-.8L8 2.9z'/%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 12px;
        }

        .form-select option {
            background: white;
            color: #333;
            padding: 10px;
            border: none;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.5);
            background: rgba(255, 255, 255, 0.2);
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.15);
        }

        .form-select:focus {
            background: rgba(255, 255, 255, 0.2);
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='%23ffffff' viewBox='0 0 16 16'%3e%3cpath d='M8 2.9l4.5 4.5-.7.8L8 4.4 4.2 8.2l-.7-.8L8 2.9z'/%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 12px;
        }

        .form-input::placeholder,
        .form-textarea::placeholder {
            color: var(--text-secondary);
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 16px;
            padding: 16px 32px;
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 
                0 8px 25px rgba(102, 126, 234, 0.3),
                0 4px 15px rgba(0, 0, 0, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
            min-height: 50px;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(255, 255, 255, 0.2),
                transparent
            );
            transition: left 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            box-shadow: 
                0 12px 35px rgba(102, 126, 234, 0.4),
                0 8px 25px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            background: linear-gradient(135deg, #7c8cef 0%, #8b5dbf 100%);
        }

        .btn:active {
            transition: all 0.1s ease;
            box-shadow: 
                0 4px 15px rgba(102, 126, 234, 0.3),
                0 2px 8px rgba(0, 0, 0, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .btn:focus {
            outline: none;
            box-shadow: 
                0 8px 25px rgba(102, 126, 234, 0.3),
                0 4px 15px rgba(0, 0, 0, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.2),
                0 0 0 3px rgba(102, 126, 234, 0.3);
        }

        .btn i {
            font-size: 1.1rem;
            filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.3));
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.12);
            border: 2px solid rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            box-shadow: 
                0 6px 20px rgba(255, 255, 255, 0.1),
                0 4px 15px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.18);
            border-color: rgba(255, 255, 255, 0.45);
            box-shadow: 
                0 8px 25px rgba(255, 255, 255, 0.15),
                0 6px 20px rgba(0, 0, 0, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.4);
        }

        .btn-secondary:active {
            background: rgba(255, 255, 255, 0.15);
        }

        .dates-grid {
            display: grid;
            gap: 15px;
            margin-top: 20px;
        }

        .date-card {
            background: rgba(255, 255, 255, 0.12);
            backdrop-filter: blur(6px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 14px;
            padding: 20px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .date-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .date-card.confirmed::before {
            background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
        }

        .date-card.pending::before {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
        }

        .date-card.cancelled::before {
            background: linear-gradient(135deg, #f87171 0%, #ef4444 100%);
        }

        .date-card:hover {
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .date-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .date-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 5px;
        }

        .date-info {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .date-status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-proposed {
            background: rgba(102, 126, 234, 0.2);
            color: #667eea;
            border: 1px solid rgba(102, 126, 234, 0.3);
        }

        .status-confirmed {
            background: rgba(74, 222, 128, 0.2);
            color: #4ade80;
            border: 1px solid rgba(74, 222, 128, 0.3);
        }

        .status-pending {
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
            border: 1px solid rgba(251, 191, 36, 0.3);
        }

        .status-cancelled {
            background: rgba(248, 113, 113, 0.2);
            color: #f87171;
            border: 1px solid rgba(248, 113, 113, 0.3);
        }

        .date-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 15px;
        }

        .btn-small {
            padding: 10px 16px;
            font-size: 0.9rem;
            border-radius: 12px;
            min-width: auto;
            min-height: 40px;
            box-shadow: 
                0 4px 15px rgba(0, 0, 0, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
        }

        .btn-small::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(255, 255, 255, 0.15),
                transparent
            );
            transition: left 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .btn-small:hover::before {
            left: 100%;
        }

        .btn-small:hover {
            box-shadow: 
                0 6px 20px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .btn-confirm {
            background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
            box-shadow: 
                0 4px 15px rgba(74, 222, 128, 0.3),
                0 2px 8px rgba(0, 0, 0, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .btn-confirm:hover {
            background: linear-gradient(135deg, #5de68a 0%, #34d572 100%);
            box-shadow: 
                0 6px 20px rgba(74, 222, 128, 0.4),
                0 4px 15px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .btn-reject,
        .btn-delete {
            background: linear-gradient(135deg, #f87171 0%, #ef4444 100%);
            box-shadow: 
                0 4px 15px rgba(248, 113, 113, 0.3),
                0 2px 8px rgba(0, 0, 0, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .btn-reject:hover,
        .btn-delete:hover {
            background: linear-gradient(135deg, #f98181 0%, #f56565 100%);
            box-shadow: 
                0 6px 20px rgba(248, 113, 113, 0.4),
                0 4px 15px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .btn-edit {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            box-shadow: 
                0 4px 15px rgba(251, 191, 36, 0.3),
                0 2px 8px rgba(0, 0, 0, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .btn-edit:hover {
            background: linear-gradient(135deg, #fcd34d 0%, #f6a515 100%);
            box-shadow: 
                0 6px 20px rgba(251, 191, 36, 0.4),
                0 4px 15px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .btn-calendar {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            box-shadow: 
                0 4px 15px rgba(139, 92, 246, 0.3),
                0 2px 8px rgba(0, 0, 0, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .btn-calendar:hover {
            background: linear-gradient(135deg, #a78bfa 0%, #8b5eef 100%);
            box-shadow: 
                0 6px 20px rgba(139, 92, 246, 0.4),
                0 4px 15px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        /* Amélioration du bouton de fermeture du modal d'édition */
        .close-modal {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            font-size: 1.3rem;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 8px;
            border-radius: 10px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .close-modal:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
            color: var(--text-primary);
            transform: rotate(90deg);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        }

        .close-modal:active {
            transform: rotate(90deg) scale(0.95);
        }

        /* Styles pour les notifications */
        .notification {
            position: fixed;
            top: 80px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            padding: 16px 20px;
            color: #1f2937;
            font-weight: 500;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.25);
            transform: translateX(400px);
            transition: all 0.4s ease;
            z-index: 10000;
            max-width: 300px;
            min-width: 250px;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            border-left: 4px solid #22c55e;
            background: rgba(34, 197, 94, 0.1);
        }

        .notification.error {
            border-left: 4px solid #ef4444;
            background: rgba(239, 68, 68, 0.1);
        }

        .notification.warning {
            border-left: 4px solid #f59e0b;
            background: rgba(245, 158, 11, 0.1);
        }

        @media (max-width: 480px) {
            .notification {
                top: 60px;
                right: 10px;
                left: 10px;
                max-width: none;
                min-width: auto;
                transform: translateY(-100px);
            }
            
            .notification.show {
                transform: translateY(0);
            }
        }

        /* Styles pour le modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 9999;
            opacity: 0;
            transition: all 0.3s ease;
        }

        .modal.show {
            display: flex;
            opacity: 1;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-content {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.4);
            border-radius: 20px;
            padding: 35px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            color: #ffffff;
            transform: scale(0.9);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
        }

        .modal.show .modal-content {
            transform: scale(1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .modal-title {
            margin: 0;
            color: #ffffff;
            font-size: 1.3rem;
            font-weight: 600;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #6b7280;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .close-modal:hover {
            background: rgba(0, 0, 0, 0.1);
            color: #1f2937;
        }

        /* Barre de défilement discrète pour les modals */
        .modal-content::-webkit-scrollbar {
            width: 6px;
        }

        .modal-content::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 3px;
        }

        .modal-content::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.15);
            border-radius: 3px;
            transition: background 0.3s ease;
        }

        .modal-content::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 0, 0, 0.25);
        }

        /* Firefox */
        .modal-content {
            scrollbar-width: thin;
            scrollbar-color: rgba(0, 0, 0, 0.15) rgba(0, 0, 0, 0.05);
        }

        @media (max-width: 480px) {
            .modal-content::-webkit-scrollbar {
                width: 4px;
            }
        }

        /* Loading indicator */
        .loading-indicator {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-secondary);
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid var(--text-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* No dates message */
        .no-dates {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-secondary);
        }

        .no-dates i {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.7;
        }

        .no-dates h3 {
            font-size: 1.3rem;
            margin-bottom: 10px;
            color: var(--text-primary);
        }

        /* Amélioration des inputs dans le modal */
        .modal .form-input,
        .modal .form-select,
        .modal .form-textarea {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #ffffff;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        /* Styles spécifiques pour les dropdowns dans les modals */
        .modal .form-select {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #ffffff;
            cursor: pointer;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='%23ffffff' viewBox='0 0 16 16'%3e%3cpath d='M8 13.1l4.5-4.5-.7-.8L8 11.6 4.2 7.8l-.7.8L8 13.1z'/%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 12px;
            padding-right: 40px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .modal .form-select:hover {
            background: rgba(255, 255, 255, 0.3);
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='%23ffffff' viewBox='0 0 16 16'%3e%3cpath d='M8 13.1l4.5-4.5-.7-.8L8 11.6 4.2 7.8l-.7.8L8 13.1z'/%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 12px;
            border-color: rgba(255, 255, 255, 0.4);
        }

        .modal .form-select option {
            background: white;
            color: #333;
            padding: 10px;
            border: none;
        }

        .modal .form-input::placeholder,
        .modal .form-textarea::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .modal .form-input:focus,
        .modal .form-select:focus,
        .modal .form-textarea:focus {
            background: rgba(255, 255, 255, 0.25);
            border-color: rgba(255, 255, 255, 0.5);
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.2);
        }

        .modal .form-select:focus {
            background: rgba(255, 255, 255, 0.25);
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='%23ffffff' viewBox='0 0 16 16'%3e%3cpath d='M8 2.9l4.5 4.5-.7.8L8 4.4 4.2 8.2l-.7-.8L8 2.9z'/%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 12px;
        }

        .modal .form-label {
            color: #ffffff;
            font-weight: 600;
            text-shadow: 0 1px 5px rgba(0, 0, 0, 0.3);
        }

        .date-description {
            color: var(--text-primary);
            line-height: 1.5;
            margin-bottom: 15px;
        }

        .date-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.9rem;
            border-radius: 10px;
        }

        .btn-confirm {
            background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
        }

        .btn-reject {
            background: linear-gradient(135deg, #f87171 0%, #ef4444 100%);
        }

        .btn-edit {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
        }

        .btn-delete {
            background: linear-gradient(135deg, #f87171 0%, #ef4444 100%);
        }

        .loading-indicator {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid var(--text-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .no-dates {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .no-dates i {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .no-dates h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            transition: opacity 0.3s ease;
            backdrop-filter: blur(5px);
        }

        .modal.show {
            display: flex;
            opacity: 1;
        }

        .modal-content {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            transform: scale(0.9) translateY(20px);
            transition: transform 0.3s ease;
        }

        .modal.show .modal-content {
            transform: scale(1) translateY(0);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 5px;
            border-radius: 5px;
            transition: all 0.3s ease;
        }

        .close-modal:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }

        /* Barre de défilement discrète pour les modals */
        .modal-content::-webkit-scrollbar {
            width: 6px;
        }

        .modal-content::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 3px;
        }

        .modal-content::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.15);
            border-radius: 3px;
            transition: background 0.3s ease;
        }

        .modal-content::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 0, 0, 0.25);
        }

        /* Firefox */
        .modal-content {
            scrollbar-width: thin;
            scrollbar-color: rgba(0, 0, 0, 0.15) rgba(0, 0, 0, 0.05);
        }

        @media (max-width: 480px) {
            .modal-content::-webkit-scrollbar {
                width: 4px;
            }
        }

        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .date-card {
            animation: fadeInUp 0.5s ease-out forwards;
        }

        .date-card.new-date {
            animation: fadeInUp 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        .date-card.removing {
            animation: fadeOut 0.3s ease-out forwards;
            pointer-events: none;
        }

        @keyframes fadeOut {
            to {
                opacity: 0;
                transform: translateY(-20px) scale(0.9);
            }
        }

        /* Notification styles */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--glass-bg);
            backdrop-filter: blur(15px);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            padding: 15px 20px;
            color: var(--text-primary);
            z-index: 3000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            border-left: 4px solid #4ade80;
        }

        .notification.error {
            border-left: 4px solid #f87171;
        }

        .notification.warning {
            border-left: 4px solid #fbbf24;
        }

        /* ===== Corrections pour l'autocomplete ===== */
        /* Empêche les suggestions automatiques de modifier l'apparence des inputs */
        input:-webkit-autofill,
        input:-webkit-autofill:hover,
        input:-webkit-autofill:focus,
        input:-webkit-autofill:active,
        select:-webkit-autofill,
        select:-webkit-autofill:hover,
        select:-webkit-autofill:focus,
        select:-webkit-autofill:active,
        textarea:-webkit-autofill,
        textarea:-webkit-autofill:hover,
        textarea:-webkit-autofill:focus,
        textarea:-webkit-autofill:active {
            -webkit-box-shadow: 0 0 0 30px transparent inset !important;
            -webkit-text-fill-color: var(--text-primary, #ffffff) !important;
            background: transparent !important;
            background-color: transparent !important;
            background-image: none !important;
            transition: background-color 5000s ease-in-out 0s !important;
        }

        /* Pour les inputs standards */
        .form-input:-webkit-autofill,
        .form-input:-webkit-autofill:hover,
        .form-input:-webkit-autofill:focus,
        .form-input:-webkit-autofill:active,
        .form-textarea:-webkit-autofill,
        .form-textarea:-webkit-autofill:hover,
        .form-textarea:-webkit-autofill:focus,
        .form-textarea:-webkit-autofill:active {
            -webkit-box-shadow: 0 0 0 30px rgba(255, 255, 255, 0.15) inset !important;
            -webkit-text-fill-color: var(--text-primary) !important;
            background: rgba(255, 255, 255, 0.15) !important;
            transition: all 0.3s ease !important;
        }

        /* Pour les dropdowns avec autocomplete */
        .form-select:-webkit-autofill,
        .form-select:-webkit-autofill:hover,
        .form-select:-webkit-autofill:focus,
        .form-select:-webkit-autofill:active {
            -webkit-box-shadow: 0 0 0 30px rgba(255, 255, 255, 0.15) inset !important;
            -webkit-text-fill-color: var(--text-primary) !important;
            background: rgba(255, 255, 255, 0.15) !important;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='%23ffffff' viewBox='0 0 16 16'%3e%3cpath d='M8 13.1l4.5-4.5-.7-.8L8 11.6 4.2 7.8l-.7.8L8 13.1z'/%3e%3c/svg%3e") !important;
            background-repeat: no-repeat !important;
            background-position: right 12px center !important;
            background-size: 12px !important;
            transition: all 0.3s ease !important;
        }

        /* Pour les inputs dans les modals */
        .modal .form-input:-webkit-autofill,
        .modal .form-input:-webkit-autofill:hover,
        .modal .form-input:-webkit-autofill:focus,
        .modal .form-input:-webkit-autofill:active,
        .modal .form-textarea:-webkit-autofill,
        .modal .form-textarea:-webkit-autofill:hover,
        .modal .form-textarea:-webkit-autofill:focus,
        .modal .form-textarea:-webkit-autofill:active {
            -webkit-box-shadow: 0 0 0 30px rgba(255, 255, 255, 0.2) inset !important;
            -webkit-text-fill-color: var(--text-primary) !important;
            background: rgba(255, 255, 255, 0.2) !important;
            transition: all 0.3s ease !important;
        }

        .modal .form-select:-webkit-autofill,
        .modal .form-select:-webkit-autofill:hover,
        .modal .form-select:-webkit-autofill:focus,
        .modal .form-select:-webkit-autofill:active {
            -webkit-box-shadow: 0 0 0 30px rgba(255, 255, 255, 0.2) inset !important;
            -webkit-text-fill-color: var(--text-primary) !important;
            background: rgba(255, 255, 255, 0.2) !important;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='%23ffffff' viewBox='0 0 16 16'%3e%3cpath d='M8 13.1l4.5-4.5-.7-.8L8 11.6 4.2 7.8l-.7.8L8 13.1z'/%3e%3c/svg%3e") !important;
            background-repeat: no-repeat !important;
            background-position: right 12px center !important;
            background-size: 12px !important;
            transition: all 0.3s ease !important;
        }

        .edit-modal-content {
            max-width: 600px;
            padding-bottom: 30px;
        }

        .edit-modal-content .form-group {
            margin-bottom: 15px;
        }

        .edit-modal-content .form-input,
        .edit-modal-content .form-select,
        .edit-modal-content .form-textarea {
            width: 100%;
            padding: 12px 15px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.4);
            background: rgba(255, 255, 255, 0.15);
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .edit-modal-content .form-input:focus,
        .edit-modal-content .form-select:focus,
        .edit-modal-content .form-textarea:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.8);
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
        }

        .edit-modal-content .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        .edit-modal-content .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .edit-actions {
            margin-top: 30px;
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        .delete-confirm-content {
            text-align: center;
            padding-bottom: 30px;
            max-width: 500px;
        }

        .delete-confirm-content .delete-confirm-icon {
            font-size: 4rem;
            color: #ff6b6b;
            margin-bottom: 20px;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .delete-confirm-content .delete-confirm-text {
            margin: 20px 0 30px;
            font-size: 1.1rem;
            color: var(--text-primary);
            line-height: 1.6;
        }

        .delete-confirm-content .date-preview {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 15px;
            margin: 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .delete-confirm-content .date-preview h4 {
            margin-bottom: 10px;
            color: var(--text-primary);
            font-size: 1.1rem;
        }

        .delete-confirm-content .date-preview p {
            margin: 5px 0;
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
        }

        .delete-confirm-actions {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .btn-delete {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            border: none;
            color: white;
            transition: all 0.3s ease;
        }

        .btn-delete:hover {
            background: linear-gradient(135deg, #ff5252, #d32f2f);
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.4);
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-button" title="Retour à l'accueil">
        <i class="fas fa-arrow-left"></i>
    </a>

    <button class="theme-button" id="themeButton" onclick="openThemeModal()" title="Changer le thème">
        <i class="fas fa-palette"></i>
    </button>
    <button class="settings-button" id="settingsButton" onclick="openSettingsModal()" title="Paramètres">
        <i class="fas fa-cog"></i>
    </button>

    <div class="container">
        <div class="header">
            <h1>💕 Date Planner 💕</h1>
            <p>Plz sors avec moi 😔</p>
        </div>

        <div class="main-content">
            <!-- Section pour proposer une nouvelle date -->
            <div class="section-card">
                <h2 class="section-title">
                    <i class="fas fa-calendar-plus"></i>
                    Proposer un rendez-vous
                </h2>
                
                <form id="dateForm">
                    <div class="form-group">
                        <label class="form-label" for="dateTitle">Titre du rendez-vous</label>
                        <input type="text" id="dateTitle" name="title" class="form-input" placeholder="SUSHI NIGHT" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="dateDate">Date</label>
                        <input type="date" id="dateDate" name="date" class="form-input" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="dateTime">Heure</label>
                        <input type="time" id="dateTime" name="time" class="form-input" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="dateLocation">Lieu</label>
                        <input type="text" id="dateLocation" name="location" class="form-input" placeholder="Choisi je t'en supplie" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="dateCategory">Catégorie</label>
                        <select id="dateCategory" name="category" class="form-select" required>
                            <option value="">Choisir une catégorie</option>
                            <option value="restaurant">🍽️ Restaurant</option>
                            <option value="cinema">🎬 Cinéma</option>
                            <option value="promenade">🚶‍♀️ Promenade</option>
                            <option value="sport">🏃‍♀️ Sport</option>
                            <option value="culture">🎭 Culture</option>
                            <option value="detente">🛁 Détente</option>
                            <option value="voyage">✈️ Voyage</option>
                            <option value="surprise">🎁 Surprise</option>
                            <option value="autre">❤️ Autre</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="dateDescription">Description</label>
                        <textarea id="dateDescription" name="description" class="form-textarea" placeholder="Tu veux faire quoi exactement ?"></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="dateProposedBy">Proposé par</label>
                        <select id="dateProposedBy" name="proposedBy" class="form-select" required>
                            <option value="">Qui propose ?</option>
                            <option value="ben">Ben</option>
                            <option value="sanaa">Sanaa</option>
                        </select>
                    </div>

                    <button type="submit" class="btn">
                        <i class="fas fa-heart"></i>
                        Proposer ce rendez-vous
                    </button>
                </form>
            </div>

            <!-- Section pour voir les rendez-vous -->
            <div class="section-card">
                <div class="section-title-with-refresh">
                    <h2 class="section-title">
                        <i class="fas fa-calendar-heart"></i>
                        Nos rendez-vous
                    </h2>
                    <button class="refresh-button" onclick="refreshDates()" title="Actualiser les rendez-vous">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                </div>
                
                <div class="filter-options" style="margin-bottom: 20px;">
                    <select id="statusFilter" class="form-select" style="margin-bottom: 10px;">
                        <option value="all">Tous les statuts</option>
                        <option value="proposed">Proposés</option>
                        <option value="confirmed">Confirmés</option>
                        <option value="pending">En attente</option>
                        <option value="cancelled">Annulés</option>
                    </select>
                </div>

                <div id="datesContainer">
                    <div class="loading-indicator">
                        <div class="loading-spinner"></div>
                        <p>Chargement des rendez-vous...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal pour éditer un rendez-vous -->
    <div class="theme-modal" id="editModal">
        <div class="theme-modal-content edit-modal-content">
            <div class="theme-modal-header">
                <h3>Tu veux le modifier ???</h3>
                <p>Préviens moi au moins plz 😔</p>
            </div>
            <form id="editForm">
                <input type="hidden" id="editDateId" name="dateId">
                
                <div class="form-group">
                    <label class="form-label" for="editTitle">Titre</label>
                    <input type="text" id="editTitle" name="title" class="form-input" required>
                </div>

                <div class="form-group">
                    <label class="form-label" for="editDate">Date</label>
                    <input type="date" id="editDate" name="date" class="form-input" required>
                </div>

                <div class="form-group">
                    <label class="form-label" for="editTime">Heure</label>
                    <input type="time" id="editTime" name="time" class="form-input" required>
                </div>

                <div class="form-group">
                    <label class="form-label" for="editLocation">Lieu</label>
                    <input type="text" id="editLocation" name="location" class="form-input" required>
                </div>

                <div class="form-group">
                    <label class="form-label" for="editCategory">Catégorie</label>
                    <select id="editCategory" name="category" class="form-select" required>
                        <option value="restaurant">🍽️ Restaurant</option>
                        <option value="cinema">🎬 Cinéma</option>
                        <option value="promenade">🚶‍♀️ Promenade</option>
                        <option value="sport">🏃‍♀️ Sport</option>
                        <option value="culture">🎭 Culture</option>
                        <option value="detente">🛁 Détente</option>
                        <option value="voyage">✈️ Voyage</option>
                        <option value="surprise">🎁 Surprise</option>
                        <option value="autre">❤️ Autre</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label" for="editDescription">Description</label>
                    <textarea id="editDescription" name="description" class="form-textarea"></textarea>
                </div>

                <div class="edit-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeEditModal()">
                        <i class="fas fa-times"></i> Annuler
                    </button>
                    <button type="submit" class="btn">
                        <i class="fas fa-save"></i> Sauvegarder
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal pour les thèmes -->
    <div class="theme-modal" id="themeModal">
        <div class="theme-modal-content">
            <div class="theme-modal-header">
                <h3>Choisir un thème</h3>
                <p>Si tu veux changer les couleurs demande moi 😽</p>
            </div>
            <div class="themes-grid">
                <div class="theme-option" onclick="changeTheme('default')">
                    <div class="theme-circle gradient active" id="theme-circle-default" style="--theme-color-1: #667eea; --theme-color-2: #764ba2;"></div>
                    <span class="theme-name">Violet</span>
                </div>
                <div class="theme-option" onclick="changeTheme('yellow')">
                    <div class="theme-circle gradient" id="theme-circle-yellow" style="--theme-color-1: #ffd54f; --theme-color-2: #ffb300;"></div>
                    <span class="theme-name">Jaune</span>
                </div>
                <div class="theme-option" onclick="changeTheme('green')">
                    <div class="theme-circle gradient" id="theme-circle-green" style="--theme-color-1: #81c784; --theme-color-2: #4caf50;"></div>
                    <span class="theme-name">Vert</span>
                </div>
                <div class="theme-option" onclick="changeTheme('pink')">
                    <div class="theme-circle gradient" id="theme-circle-pink" style="--theme-color-1: #f48fb1; --theme-color-2: #e91e63;"></div>
                    <span class="theme-name">Rose</span>
                </div>
                <div class="theme-option" onclick="changeTheme('red')">
                    <div class="theme-circle gradient" id="theme-circle-red" style="--theme-color-1: #ef5350; --theme-color-2: #d32f2f;"></div>
                    <span class="theme-name">Rouge</span>
                </div>
                <div class="theme-option" onclick="changeTheme('beige')">
                    <div class="theme-circle gradient" id="theme-circle-beige" style="--theme-color-1: #dcc9a3; --theme-color-2: #8d6e63;"></div>
                    <span class="theme-name">Beige</span>
                </div>
                <div class="theme-option" onclick="changeTheme('lavender')">
                    <div class="theme-circle gradient" id="theme-circle-lavender" style="--theme-color-1: #ce93d8; --theme-color-2: #9c27b0;"></div>
                    <span class="theme-name">Lavande</span>
                </div>
                <div class="theme-option" onclick="changeTheme('peach')">
                    <div class="theme-circle gradient" id="theme-circle-peach" style="--theme-color-1: #ffb74d; --theme-color-2: #ff9800;"></div>
                    <span class="theme-name">Pêche</span>
                </div>
                <div class="theme-option" onclick="changeTheme('mint')">
                    <div class="theme-circle gradient" id="theme-circle-mint" style="--theme-color-1: #4db6ac; --theme-color-2: #00796b;"></div>
                    <span class="theme-name">Menthe</span>
                </div>
            </div>            
            <button class="close-theme-modal-btn" onclick="closeThemeModal()">Fermer</button>
        </div>
    </div>

    <!-- Modal de confirmation pour la suppression -->
    <div class="theme-modal" id="deleteConfirmModal">
        <div class="theme-modal-content delete-confirm-content">
            <div class="theme-modal-header">
                <div class="delete-confirm-icon">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <h3>Confirmation de suppression</h3>
                <p>:(</p>
            </div>
            
            <div class="date-preview" id="deletePreview">
                <!-- Le contenu sera rempli dynamiquement -->
            </div>
            
            <div class="delete-confirm-text">
                <strong>⚠️ Cette action est irréversible !</strong><br>
                Le rendez-vous sera définitivement supprimé.
            </div>
            
            <div class="delete-confirm-actions">
                <button class="btn btn-secondary" onclick="closeDeleteConfirmModal()">
                    <i class="fas fa-times"></i> Annuler
                </button>
                <button class="btn btn-delete" id="confirmDeleteBtn">
                    <i class="fas fa-trash-alt"></i> Supprimer définitivement
                </button>
            </div>
        </div>
    </div>

    <!-- Modal pour les paramètres -->
    <div class="settings-modal" id="settingsModal">
        <div class="settings-modal-content">
            <div class="settings-modal-header">
                <h3>Paramètres</h3>
                <p>Dis-moi si t'en veux d'autres 😽</p>
            </div>
            <div class="fonts-grid">
                <div class="font-option active" id="font-option-default" onclick="changeFont('default')">
                    <div class="font-preview" style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;">Abc</div>
                    <span class="font-name">Système</span>
                </div>
                <div class="font-option" id="font-option-serif" onclick="changeFont('serif')">
                    <div class="font-preview" style="font-family: Georgia, 'Times New Roman', Times, serif;">Abc</div>
                    <span class="font-name">Serif</span>
                </div>
                <div class="font-option" id="font-option-mono" onclick="changeFont('mono')">
                    <div class="font-preview" style="font-family: 'Courier New', Courier, monospace;">Abc</div>
                    <span class="font-name">Mono</span>
                </div>
                <div class="font-option" id="font-option-cursive" onclick="changeFont('cursive')">
                    <div class="font-preview" style="font-family: 'Comic Sans MS', cursive, sans-serif;">Abc</div>
                    <span class="font-name">Amusant</span>
                </div>
                <div class="font-option" id="font-option-elegant" onclick="changeFont('elegant')">
                    <div class="font-preview" style="font-family: 'Playfair Display', Georgia, serif;">Abc</div>
                    <span class="font-name">Élégant</span>
                </div>
                <div class="font-option" id="font-option-modern" onclick="changeFont('modern')">
                    <div class="font-preview" style="font-family: 'Inter', 'Segoe UI', sans-serif;">Abc</div>
                    <span class="font-name">Moderne</span>
                </div>
                <div class="font-option" id="font-option-handwriting" onclick="changeFont('handwriting')">
                    <div class="font-preview" style="font-family: 'Kalam', cursive, sans-serif;">Abc</div>
                    <span class="font-name">Manuscrit</span>
                </div>
                <div class="font-option" id="font-option-romantic" onclick="changeFont('romantic')">
                    <div class="font-preview" style="font-family: 'Dancing Script', cursive, sans-serif;">Abc</div>
                    <span class="font-name">Romantique</span>
                </div>
                <div class="font-option" id="font-option-minimal" onclick="changeFont('minimal')">
                    <div class="font-preview" style="font-family: 'Poppins', sans-serif;">Abc</div>
                    <span class="font-name">Minimal</span>
                </div>
                <div class="font-option" id="font-option-retro" onclick="changeFont('retro')">
                    <div class="font-preview" style="font-family: 'Orbitron', monospace;">Abc</div>
                    <span class="font-name">Rétro</span>
                </div>
                       </div>
            <button class="close-settings-modal-btn" onclick="closeSettingsModal()">Fermer</button>
        </div>
    </div>

    <script>
        // Configuration API
        const CONFIG = {
            api: {
                key: "$2a$10$t0WTcJrukj6V.IM/EGKgzu9LwJSaiEtSLXDRfvAj7./y5RdExWBzS",
                binId: "68604b998561e97a502da1f5" // bin: "Dates", "https://api.jsonbin.io/v3/b/68604b998561e97a502da1f5/latest"
            }
        };

        let datesData = [];
        let lastDatesHash = '';
        let refreshCooldown = false;

        // Charger les paramètres globaux (thèmes, fonts)
        function loadGlobalSettings() {
            const savedTheme = localStorage.getItem('selectedTheme') || 'default';
            document.body.classList.remove(
                'theme-default', 'theme-yellow', 'theme-green', 'theme-pink', 
                'theme-red', 'theme-beige', 'theme-lavender', 'theme-peach', 'theme-mint'
            );
            document.body.classList.add(`theme-${savedTheme}`);

            const savedFont = localStorage.getItem('selectedFont') || 'default';
            document.body.classList.remove(
                'font-default', 'font-serif', 'font-mono', 'font-cursive', 'font-elegant',
                'font-modern', 'font-handwriting', 'font-romantic', 'font-minimal', 'font-retro'
            );
            document.body.classList.add(`font-${savedFont}`);

            // Mettre à jour l'interface des thèmes si elle existe
            const targetCircle = document.getElementById(`theme-circle-${savedTheme}`);
            if (targetCircle) {
                document.querySelectorAll('.theme-circle').forEach(circle => {
                    circle.classList.remove('active');
                });
                targetCircle.classList.add('active');
            }

            // Mettre à jour l'interface des fonts si elle existe
            const targetOption = document.getElementById(`font-option-${savedFont}`);
            if (targetOption) {
                document.querySelectorAll('.font-option').forEach(option => {
                    option.classList.remove('active');
                });
                targetOption.classList.add('active');
            }
        }

        // Synchronisation en temps réel avec localStorage
        window.addEventListener('storage', function(e) {
            if (e.key === 'selectedFont') {
                const newFont = e.newValue || 'default';
                document.body.classList.remove(
                    'font-default', 'font-serif', 'font-mono', 'font-cursive', 'font-elegant',
                    'font-modern', 'font-handwriting', 'font-romantic', 'font-minimal', 'font-retro'
                );
                document.body.classList.add(`font-${newFont}`);

                // Mettre à jour l'interface si elle existe
                const targetOption = document.getElementById(`font-option-${newFont}`);
                if (targetOption) {
                    document.querySelectorAll('.font-option').forEach(option => {
                        option.classList.remove('active');
                    });
                    targetOption.classList.add('active');
                }
            } else if (e.key === 'selectedTheme') {
                const newTheme = e.newValue || 'default';
                document.body.classList.remove(
                    'theme-default', 'theme-yellow', 'theme-green', 'theme-pink', 
                    'theme-red', 'theme-beige', 'theme-lavender', 'theme-peach', 'theme-mint'
                );
                document.body.classList.add(`theme-${newTheme}`);

                // Mettre à jour l'interface si elle existe
                const targetCircle = document.getElementById(`theme-circle-${newTheme}`);
                if (targetCircle) {
                    document.querySelectorAll('.theme-circle').forEach(circle => {
                        circle.classList.remove('active');
                    });
                    targetCircle.classList.add('active');
                }
            }
        });

        // Fonction pour afficher une notification
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'exclamation-triangle'}"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => notification.classList.add('show'), 100);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => document.body.removeChild(notification), 300);
            }, 3000);
        }

        // Charger les rendez-vous depuis l'API
        async function loadDatesFromOnline() {
            try {
                const response = await fetch(`https://api.jsonbin.io/v3/b/${CONFIG.api.binId}/latest`, {
                    headers: {
                        'X-Master-Key': CONFIG.api.key
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    const newDates = data.record.dates || [];
                    const newHash = JSON.stringify(newDates);
                    
                    if (newHash !== lastDatesHash) {
                        datesData = newDates;
                        lastDatesHash = newHash;
                        displayDates();
                    }
                } else {
                    throw new Error(`Erreur API: ${response.status} ${response.statusText}`);
                }
            } catch (error) {
                console.error('Erreur lors du chargement des rendez-vous:', error);
                showNotification('Erreur de connexion à l\'API. Impossible de charger les rendez-vous.', 'error');
                
                // Afficher un message d'erreur dans le container
                const container = document.getElementById('datesContainer');
                container.innerHTML = `
                    <div class="no-dates">
                        <i class="fas fa-exclamation-triangle" style="color: #ff6b6b;"></i>
                        <h3>Erreur de connexion</h3>
                        <p>Impossible de charger les rendez-vous depuis l'API</p>
                    </div>
                `;
            }
        }

        // Sauvegarder les rendez-vous en ligne
        async function saveDatesToOnline() {
            try {
                // Récupérer d'abord les données existantes pour préserver les notes
                const currentResponse = await fetch(`https://api.jsonbin.io/v3/b/${CONFIG.api.binId}/latest`, {
                    headers: {
                        'X-Master-Key': CONFIG.api.key
                    }
                });

                let existingData = {};
                if (currentResponse.ok) {
                    const currentData = await currentResponse.json();
                    existingData = currentData.record || {};
                } else {
                    throw new Error(`Erreur lors de la récupération des données: ${currentResponse.status}`);
                }

                // Mettre à jour seulement le champ dates
                existingData.dates = datesData;

                const saveResponse = await fetch(`https://api.jsonbin.io/v3/b/${CONFIG.api.binId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': CONFIG.api.key
                    },
                    body: JSON.stringify(existingData)
                });

                if (!saveResponse.ok) {
                    throw new Error(`Erreur lors de la sauvegarde: ${saveResponse.status} ${saveResponse.statusText}`);
                }
            } catch (error) {
                console.error('Erreur lors de la sauvegarde des rendez-vous:', error);
                showNotification('Erreur de connexion à l\'API. Impossible de sauvegarder les rendez-vous.', 'error');
                throw error; // Re-throw pour que les fonctions appelantes puissent gérer l'erreur
            }
        }

        // Afficher les rendez-vous
        function displayDates() {
            const container = document.getElementById('datesContainer');
            const statusFilter = document.getElementById('statusFilter').value;
            
            // Filtrer les rendez-vous et exclure ceux avec des données manquantes
            let filteredDates = datesData.filter(date => {
                // Vérifier que les données essentielles existent
                if (!date.title || !date.date || !date.time || !date.location) {
                    return false;
                }
                
                // Appliquer le filtre de statut
                if (statusFilter !== 'all') {
                    return date.status === statusFilter;
                }
                return true;
            });

            // Trier par date (plus récent en premier)
            filteredDates.sort((a, b) => new Date(b.date + ' ' + b.time) - new Date(a.date + ' ' + a.time));

            if (filteredDates.length === 0) {
                container.innerHTML = `
                    <div class="no-dates">
                        <i class="fas fa-calendar-heart"></i>
                        <h3>Pas de rendez-vous :(</h3>
                        <p>Plzzzzz propose 🙏</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = `
                <div class="dates-grid">
                    ${filteredDates.map(date => createDateCard(date)).join('')}
                </div>
            `;
        }

        // Créer une carte de rendez-vous
        function createDateCard(date) {
            // Vérifier que les données existent avant de les utiliser
            if (!date.date || !date.title || !date.location || !date.time) {
                return ''; // Ne pas afficher si des données essentielles manquent
            }

            const formattedDate = new Date(date.date).toLocaleDateString('fr-FR', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });

            const categoryEmoji = {
                restaurant: '🍽️',
                cinema: '🎬',
                promenade: '🚶‍♀️',
                sport: '🏃‍♀️',
                culture: '🎭',
                detente: '🛁',
                voyage: '✈️',
                surprise: '🎁',
                autre: '❤️'
            };

            const proposerEmoji = date.proposedBy === 'ben' ? '👨' : '👩';
            const proposerName = date.proposedBy === 'ben' ? 'Ben' : 'Sanaa';

            return `
                <div class="date-card ${date.status}" data-date-id="${date.id}">
                    <div class="date-header">
                        <div>
                            <h3 class="date-title">${categoryEmoji[date.category]} ${date.title}</h3>
                            <div class="date-info">
                                <div><i class="fas fa-calendar"></i> ${formattedDate}</div>
                                <div><i class="fas fa-clock"></i> ${date.time}</div>
                                <div><i class="fas fa-map-marker-alt"></i> ${date.location}</div>
                                <div><i class="fas fa-user"></i> Proposé par ${proposerEmoji} ${proposerName}</div>
                            </div>
                        </div>
                        <span class="date-status status-${date.status}">${getStatusText(date.status)}</span>
                    </div>
                    
                    ${date.description ? `<p class="date-description">${date.description}</p>` : ''}
                    
                    <div class="date-actions">
                        ${getActionButtons(date)}
                        ${date.status !== 'cancelled' ? `
                            <button class="btn btn-small btn-calendar" onclick="addToCalendar('${date.id}')">
                                <i class="fas fa-calendar-plus"></i> Calendrier
                            </button>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        // Obtenir le texte du statut
        function getStatusText(status) {
            const statusTexts = {
                proposed: 'Proposé',
                confirmed: 'Confirmé',
                pending: 'En attente',
                cancelled: 'Annulé'
            };
            return statusTexts[status] || status;
        }

        // Obtenir les boutons d'action selon le statut
        function getActionButtons(date) {
            let buttons = '';
            
            if (date.status === 'proposed') {
                buttons += `
                    <button class="btn btn-small btn-confirm" onclick="confirmDate('${date.id}')">
                        <i class="fas fa-check"></i> Confirmer
                    </button>
                    <button class="btn btn-small btn-reject" onclick="rejectDate('${date.id}')">
                        <i class="fas fa-times"></i> Refuser
                    </button>
                `;
            }
            
            if (date.status === 'cancelled') {
                buttons += `
                    <button class="btn btn-small btn-confirm" onclick="reactivateDate('${date.id}')">
                        <i class="fas fa-redo"></i> Réactiver
                    </button>
                `;
            }
            
            if (date.status !== 'cancelled') {
                buttons += `
                    <button class="btn btn-small btn-edit" onclick="editDate('${date.id}')">
                        <i class="fas fa-edit"></i> Modifier
                    </button>
                `;
            }
            
            buttons += `
                <button class="btn btn-small btn-delete" onclick="deleteDate('${date.id}')">
                    <i class="fas fa-trash"></i> Supprimer
                </button>
            `;
            
            return buttons;
        }

        // Proposer un nouveau rendez-vous
        async function proposeDate(formData) {
            // Vérifier que tous les champs obligatoires sont remplis
            const title = formData.get('title');
            const date = formData.get('date');
            const time = formData.get('time');
            const location = formData.get('location');
            const category = formData.get('category');
            const proposedBy = formData.get('proposedBy');

            if (!title || !date || !time || !location || !category || !proposedBy) {
                showNotification('Veuillez remplir tous les champs obligatoires', 'error');
                return;
            }

            const newDate = {
                id: Date.now().toString(),
                title: title,
                date: date,
                time: time,
                location: location,
                category: category,
                description: formData.get('description') || '',
                proposedBy: proposedBy,
                status: 'proposed',
                createdAt: new Date().toISOString()
            };

            try {
                datesData.unshift(newDate);
                lastDatesHash = JSON.stringify(datesData);
                
                await saveDatesToOnline();
                displayDates();
                
                showNotification('Rendez-vous proposé avec succès ! 💕');
            } catch (error) {
                // Retirer le rendez-vous de la liste en cas d'erreur
                datesData = datesData.filter(d => d.id !== newDate.id);
                displayDates();
            }
        }

        // Confirmer un rendez-vous
        async function confirmDate(dateId) {
            const dateIndex = datesData.findIndex(d => d.id === dateId);
            if (dateIndex !== -1) {
                const originalStatus = datesData[dateIndex].status;
                
                try {
                    datesData[dateIndex].status = 'confirmed';
                    lastDatesHash = JSON.stringify(datesData);
                    await saveDatesToOnline();
                    displayDates();
                    showNotification('Rendez-vous confirmé ! 🎉');
                } catch (error) {
                    // Restaurer le statut original en cas d'erreur
                    datesData[dateIndex].status = originalStatus;
                    displayDates();
                }
            }
        }

        // Refuser un rendez-vous
        async function rejectDate(dateId) {
            const dateIndex = datesData.findIndex(d => d.id === dateId);
            if (dateIndex !== -1) {
                const originalStatus = datesData[dateIndex].status;
                
                try {
                    datesData[dateIndex].status = 'cancelled';
                    lastDatesHash = JSON.stringify(datesData);
                    await saveDatesToOnline();
                    displayDates();
                    showNotification('Rendez-vous refusé.', 'warning');
                } catch (error) {
                    // Restaurer le statut original en cas d'erreur
                    datesData[dateIndex].status = originalStatus;
                    displayDates();
                }
            }
        }

        // Réactiver un rendez-vous annulé
        async function reactivateDate(dateId) {
            const dateIndex = datesData.findIndex(d => d.id === dateId);
            if (dateIndex !== -1) {
                const originalStatus = datesData[dateIndex].status;
                
                try {
                    datesData[dateIndex].status = 'proposed';
                    lastDatesHash = JSON.stringify(datesData);
                    await saveDatesToOnline();
                    displayDates();
                    showNotification('Rendez-vous réactivé ! 💕', 'success');
                } catch (error) {
                    // Restaurer le statut original en cas d'erreur
                    datesData[dateIndex].status = originalStatus;
                    displayDates();
                }
            }
        }

        // Supprimer un rendez-vous - ouvrir le modal de confirmation
        function deleteDate(dateId) {
            const date = datesData.find(d => d.id === dateId);
            if (!date) return;
            
            // Préparer l'aperçu du rendez-vous à supprimer
            const formattedDate = new Date(date.date).toLocaleDateString('fr-FR', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });

            const categoryEmoji = {
                restaurant: '🍽️',
                cinema: '🎬',
                promenade: '🚶‍♀️',
                sport: '🏃‍♀️',
                culture: '🎭',
                detente: '🛁',
                voyage: '✈️',
                surprise: '🎁',
                autre: '❤️'
            };

            const proposerName = date.proposedBy === 'ben' ? 'Ben' : 'Sanaa';

            const previewHTML = `
                <h4>${categoryEmoji[date.category]} ${date.title}</h4>
                <p><i class="fas fa-calendar"></i> ${formattedDate}</p>
                <p><i class="fas fa-clock"></i> ${date.time}</p>
                <p><i class="fas fa-map-marker-alt"></i> ${date.location}</p>
                <p><i class="fas fa-user"></i> Proposé par ${proposerName}</p>
            `;

            document.getElementById('deletePreview').innerHTML = previewHTML;
            
            // Configurer le bouton de confirmation
            const confirmBtn = document.getElementById('confirmDeleteBtn');
            confirmBtn.onclick = () => confirmDeleteDate(dateId);
            
            openDeleteConfirmModal();
        }

        // Ouvrir le modal de confirmation de suppression
        function openDeleteConfirmModal() {
            const modal = document.getElementById('deleteConfirmModal');
            const content = modal.querySelector('.theme-modal-content');
            
            modal.style.display = 'flex';
            modal.classList.remove('closing');
            content.classList.remove('animate-out');
            
            requestAnimationFrame(() => {
                modal.classList.add('show');
                content.classList.add('animate-in');
            });
        }

        // Fermer le modal de confirmation de suppression
        function closeDeleteConfirmModal() {
            const modal = document.getElementById('deleteConfirmModal');
            const content = modal.querySelector('.theme-modal-content');
            
            modal.classList.add('closing');
            content.classList.remove('animate-in');
            content.classList.add('animate-out');
            
            setTimeout(() => {
                modal.classList.remove('show', 'closing');
                modal.style.display = 'none';
                content.classList.remove('animate-out');
            }, 300);
        }

        // Confirmer la suppression du rendez-vous
        async function confirmDeleteDate(dateId) {
            closeDeleteConfirmModal();
            
            const dateElement = document.querySelector(`[data-date-id="${dateId}"]`);
            const originalDatesData = [...datesData]; // Sauvegarde pour restauration
            
            if (dateElement) {
                dateElement.classList.add('removing');
                
                setTimeout(async () => {
                    try {
                        datesData = datesData.filter(d => d.id !== dateId);
                        lastDatesHash = JSON.stringify(datesData);
                        await saveDatesToOnline();
                        displayDates();
                        showNotification('Rendez-vous supprimé.', 'warning');
                    } catch (error) {
                        // Restaurer les données en cas d'erreur
                        datesData = originalDatesData;
                        displayDates();
                    }
                }, 300);
            } else {
                try {
                    datesData = datesData.filter(d => d.id !== dateId);
                    lastDatesHash = JSON.stringify(datesData);
                    await saveDatesToOnline();
                    displayDates();
                    showNotification('Rendez-vous supprimé.', 'warning');
                } catch (error) {
                    // Restaurer les données en cas d'erreur
                    datesData = originalDatesData;
                    displayDates();
                }
            }
        }

        // Éditer un rendez-vous
        function editDate(dateId) {
            const date = datesData.find(d => d.id === dateId);
            if (!date) return;
            
            // Préremplir le formulaire d'édition
            document.getElementById('editDateId').value = date.id;
            document.getElementById('editTitle').value = date.title;
            document.getElementById('editDate').value = date.date;
            document.getElementById('editTime').value = date.time || '';
            document.getElementById('editLocation').value = date.location;
            document.getElementById('editCategory').value = date.category;
            document.getElementById('editDescription').value = date.description || '';
            
            // Afficher le modal avec animation
            const modal = document.getElementById('editModal');
            const content = modal.querySelector('.theme-modal-content');
            
            modal.style.display = 'flex';
            modal.classList.remove('closing');
            content.classList.remove('animate-out');
            
            requestAnimationFrame(() => {
                modal.classList.add('show');
                content.classList.add('animate-in');
            });
        }

        function closeEditModal() {
            const modal = document.getElementById('editModal');
            const content = modal.querySelector('.theme-modal-content');
            
            modal.classList.add('closing');
            content.classList.remove('animate-in');
            content.classList.add('animate-out');
            
            setTimeout(() => {
                modal.classList.remove('show', 'closing');
                modal.style.display = 'none';
                content.classList.remove('animate-out');
            }, 300);
        }

        // Sauvegarder les modifications
        async function saveEdit(formData) {
            const dateId = formData.get('dateId');
            const dateIndex = datesData.findIndex(d => d.id === dateId);
            
            if (dateIndex !== -1) {
                // Vérifier que les champs obligatoires sont remplis
                const title = formData.get('title');
                const date = formData.get('date');
                const time = formData.get('time');
                const location = formData.get('location');
                const category = formData.get('category');

                if (!title || !date || !time || !location || !category) {
                    showNotification('Veuillez remplir tous les champs obligatoires', 'error');
                    return;
                }

                const originalData = { ...datesData[dateIndex] }; // Sauvegarde pour restauration
                
                try {
                    datesData[dateIndex] = {
                        ...datesData[dateIndex],
                        title: title,
                        date: date,
                        time: time,
                        location: location,
                        category: category,
                        description: formData.get('description') || '',
                        updatedAt: new Date().toISOString()
                    };
                    
                    lastDatesHash = JSON.stringify(datesData);
                    await saveDatesToOnline();
                    displayDates();
                    closeEditModal();
                    showNotification('Rendez-vous modifié avec succès !');
                } catch (error) {
                    // Restaurer les données originales en cas d'erreur
                    datesData[dateIndex] = originalData;
                    displayDates();
                }
            }
        }

        // Ajouter au calendrier iPhone
        function addToCalendar(dateId) {
            const date = datesData.find(d => d.id === dateId);
            if (!date) return;

            try {
                // Créer la date de début et de fin
                const startDate = new Date(`${date.date}T${date.time}`);
                const endDate = new Date(startDate.getTime() + (2 * 60 * 60 * 1000)); // +2h par défaut

                // Formater les dates pour l'URL
                const formatDate = (d) => d.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';

                // Préparer les détails de l'événement
                const title = encodeURIComponent(date.title || 'Rendez-vous');
                const location = encodeURIComponent(date.location || '');
                const description = encodeURIComponent(date.description || `Rendez-vous romantique proposé par ${date.proposedBy === 'ben' ? 'Ben' : 'Sanaa'}`);

                // Détecter si c'est un iPhone/iPad
                const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);

                if (isIOS) {
                    // Créer l'URL pour Google Calendar qui marchera aussi sur iOS
                    const googleUrl = `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${title}&dates=${formatDate(startDate)}/${formatDate(endDate)}&location=${location}&details=${description}`;
                    
                    // Essayer d'abord d'ouvrir l'app Calendrier native avec un événement spécifique
                    const calendarData = `BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//Date Planner//EN
BEGIN:VEVENT
UID:${date.id}@dateplanner.app
DTSTART:${formatDate(startDate)}
DTEND:${formatDate(endDate)}
SUMMARY:${date.title}
DESCRIPTION:${date.description || `Rendez-vous romantique proposé par ${date.proposedBy === 'ben' ? 'Ben' : 'Sanaa'}`}
LOCATION:${date.location}
END:VEVENT
END:VCALENDAR`;

                    // Créer un blob et un lien de téléchargement
                    const blob = new Blob([calendarData], { type: 'text/calendar' });
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `${date.title.replace(/[^a-z0-9]/gi, '_')}.ics`;
                    
                    // Tenter l'ouverture directe avec l'app calendrier
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);
                    
                    // Fallback vers Google Calendar après un petit délai
                    setTimeout(() => {
                        window.open(googleUrl, '_blank');
                    }, 500);
                } else {
                    // Pour les autres appareils, utiliser Google Calendar
                    const googleUrl = `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${title}&dates=${formatDate(startDate)}/${formatDate(endDate)}&location=${location}&details=${description}`;
                    window.open(googleUrl, '_blank');
                }

                showNotification('Ajout au calendrier en cours...', 'success');
            } catch (error) {
                console.error('Erreur lors de l\'ajout au calendrier:', error);
                showNotification('Erreur lors de l\'ajout au calendrier', 'error');
            }
        }

        // Fonction pour actualiser manuellement les rendez-vous
        async function refreshDates() {
            // Vérifier le cooldown pour éviter le spam
            if (refreshCooldown) {
                return; // Pas de notification, juste bloquer silencieusement
            }

            const refreshButton = document.querySelector('.refresh-button');
            const container = document.getElementById('datesContainer');
            
            // Activer le cooldown
            refreshCooldown = true;
            
            // Animation du bouton et désactivation
            if (refreshButton) {
                refreshButton.classList.add('spinning');
                refreshButton.disabled = true;
            }
            
            // Afficher le loading identique au chargement initial
            if (container) {
                container.innerHTML = `
                    <div class="loading-indicator">
                        <div class="loading-spinner"></div>
                        <p>Actualisation des rendez-vous...</p>
                    </div>
                `;
            }
            
            try {
                // Rechargement depuis l'API uniquement
                const response = await fetch(`https://api.jsonbin.io/v3/b/${CONFIG.api.binId}/latest`, {
                    headers: {
                        'X-Master-Key': CONFIG.api.key
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    const newDates = data.record.dates || [];
                    datesData = newDates;
                    lastDatesHash = JSON.stringify(datesData);
                    displayDates();
                    showNotification('Rendez-vous actualisés !', 'success');
                } else {
                    throw new Error(`Erreur API: ${response.status} ${response.statusText}`);
                }
            } catch (error) {
                console.error('Erreur lors de l\'actualisation:', error);
                showNotification('Erreur de connexion à l\'API. Impossible d\'actualiser les rendez-vous.', 'error');
                
                // Afficher un message d'erreur dans le container
                if (container) {
                    container.innerHTML = `
                        <div class="no-dates">
                            <i class="fas fa-exclamation-triangle" style="color: #ff6b6b;"></i>
                            <h3>Erreur de connexion</h3>
                            <p>Impossible d'actualiser les rendez-vous depuis l'API</p>
                        </div>
                    `;
                }
            } finally {
                if (refreshButton) {
                    setTimeout(() => {
                        refreshButton.classList.remove('spinning');
                        refreshButton.disabled = false;
                    }, 5000);
                }
                
                // Réactiver le bouton après 5 secondes
                setTimeout(() => {
                    refreshCooldown = false;
                }, 5000);
            }
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            loadGlobalSettings();
            loadDatesFromOnline();
            
            // Actualiser toutes les 5 minutes (300 secondes) au lieu de 30 secondes
            setInterval(loadDatesFromOnline, 300000);
            
            // Définir la date minimum à aujourd'hui
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('dateDate').min = today;
            document.getElementById('editDate').min = today;
            
            // Gestionnaires d'événements pour les modals
            const themeModal = document.getElementById('themeModal');
            const settingsModal = document.getElementById('settingsModal');
            const deleteConfirmModal = document.getElementById('deleteConfirmModal');
            
            if (themeModal) {
                themeModal.addEventListener('click', function(e) {
                    if (e.target === themeModal) {
                        closeThemeModal();
                    }
                });
            }
            
            if (settingsModal) {
                settingsModal.addEventListener('click', function(e) {
                    if (e.target === settingsModal) {
                        closeSettingsModal();
                    }
                });
            }

            if (deleteConfirmModal) {
                deleteConfirmModal.addEventListener('click', function(e) {
                    if (e.target === deleteConfirmModal) {
                        closeDeleteConfirmModal();
                    }
                });
            }
            
            // Fermer avec la touche Escape
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    if (themeModal && themeModal.classList.contains('show')) {
                        closeThemeModal();
                    }
                    if (settingsModal && settingsModal.classList.contains('show')) {
                        closeSettingsModal();
                    }
                    if (deleteConfirmModal && deleteConfirmModal.classList.contains('show')) {
                        closeDeleteConfirmModal();
                    }
                }
            });
            
            // Formulaire de proposition
            document.getElementById('dateForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                const formData = new FormData(this);
                await proposeDate(formData);
                this.reset();
            });
            
            // Formulaire d'édition
            document.getElementById('editForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                const formData = new FormData(this);
                await saveEdit(formData);
            });
            
            // Filtre de statut
            document.getElementById('statusFilter').addEventListener('change', displayDates);
            
            // Fermer modal en cliquant à l'extérieur
            document.getElementById('editModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeEditModal();
                }
            });
            
            // Fermer modal avec Escape
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeEditModal();
                }
            });
        });

        // Fonctions pour les modals de thème et paramètres avec animations
        function openThemeModal() {
            const modal = document.getElementById('themeModal');
            const content = modal.querySelector('.theme-modal-content');
            
            modal.style.display = 'flex';
            modal.classList.remove('closing');
            content.classList.remove('animate-out');
            
            requestAnimationFrame(() => {
                modal.classList.add('show');
                content.classList.add('animate-in');
            });
        }

        function closeThemeModal() {
            const modal = document.getElementById('themeModal');
            const content = modal.querySelector('.theme-modal-content');
            
            modal.classList.add('closing');
            content.classList.remove('animate-in');
            content.classList.add('animate-out');
            
            setTimeout(() => {
                modal.classList.remove('show', 'closing');
                modal.style.display = 'none';
                content.classList.remove('animate-out');
            }, 300);
        }

        function changeTheme(themeName) {
            document.body.classList.remove(
                'theme-default', 'theme-yellow', 'theme-green', 'theme-pink', 
                'theme-red', 'theme-beige', 'theme-lavender', 'theme-peach', 'theme-mint'
            );

            document.body.classList.add(`theme-${themeName}`);

            document.querySelectorAll('.theme-circle').forEach(circle => {
                circle.classList.remove('active');
            });
            const targetCircle = document.getElementById(`theme-circle-${themeName}`);
            if (targetCircle) {
                targetCircle.classList.add('active');
            }

            // Utiliser le système de sauvegarde global
            localStorage.setItem('selectedTheme', themeName);
            localStorage.setItem('selectedTheme_timestamp', Date.now().toString());

            closeThemeModal();
        }

        function openSettingsModal() {
            const modal = document.getElementById('settingsModal');
            const content = modal.querySelector('.settings-modal-content');
            
            modal.style.display = 'flex';
            modal.classList.remove('closing');
            content.classList.remove('animate-out');
            
            requestAnimationFrame(() => {
                modal.classList.add('show');
                content.classList.add('animate-in');
            });
        }

        function closeSettingsModal() {
            const modal = document.getElementById('settingsModal');
            const content = modal.querySelector('.settings-modal-content');
            
            modal.classList.add('closing');
            content.classList.remove('animate-in');
            content.classList.add('animate-out');
            
            setTimeout(() => {
                modal.classList.remove('show', 'closing');
                modal.style.display = 'none';
                content.classList.remove('animate-out');
            }, 300);
        }

        function changeFont(fontName) {
            // Retirer toutes les classes de font
            document.body.classList.remove(
                'font-default', 'font-serif', 'font-mono', 'font-cursive', 'font-elegant',
                'font-modern', 'font-handwriting', 'font-romantic', 'font-minimal', 'font-retro'
            );

            // Ajouter la nouvelle classe de font
            document.body.classList.add(`font-${fontName}`);

            // Mettre à jour l'interface
            document.querySelectorAll('.font-option').forEach(option => {
                option.classList.remove('active');
            });
            const targetOption = document.getElementById(`font-option-${fontName}`);
            if (targetOption) {
                targetOption.classList.add('active');
            }

            // Sauvegarder avec synchronisation
            localStorage.setItem('selectedFont', fontName);
            localStorage.setItem('selectedFont_timestamp', Date.now().toString());

            closeSettingsModal();
        }

        // Gestionnaires d'événements pour fermer les modals
        document.addEventListener('DOMContentLoaded', function() {
            const themeModal = document.getElementById('themeModal');
            if (themeModal) {
                themeModal.addEventListener('click', function(event) {
                    if (event.target === this) {
                        closeThemeModal();
                    }
                });
            }

            const settingsModal = document.getElementById('settingsModal');
            if (settingsModal) {
                settingsModal.addEventListener('click', function(event) {
                    if (event.target === this) {                
                        closeSettingsModal();
                    }
                });
            }

            const deleteConfirmModal = document.getElementById('deleteConfirmModal');
            if (deleteConfirmModal) {
                deleteConfirmModal.addEventListener('click', function(event) {
                    if (event.target === this) {
                        closeDeleteConfirmModal();
                    }
                });
            }

            // Gestion de la touche Escape
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeThemeModal();
                    closeSettingsModal();
                    closeDeleteConfirmModal();
                }
            });
        });
    </script>
</body>
</html>
